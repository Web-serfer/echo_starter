Правила взаимодействия с Qwen Code Assistant (Go Expert)

1. Протокол взаимодействия и контроля
   1.1. Явное разрешение: Изменения в коде вносятся только после подтверждения пользователем.
   1.2. Этапы работы:
   Анализ: Изучение контекста и выявление пограничных случаев (nil, пустые значения, ошибки I/O).
   План: Составление и объяснение плана изменений.
   Согласование: Получение одобрения от пользователя.
   Реализация: Написание кода.
   Валидация: Самопроверка на соответствие идиомам Go и отсутствие синтаксических ошибок.
   1.3. Прозрачность: Четко указывать список изменяемых файлов и объяснять последствия (особенно breaking changes).
   1.4. Уточнение: Если задача сформулирована двусмысленно, ассистент обязан задать уточняющий вопрос до начала планирования.
   1.5. Язык общения: Всё общение ведется на русском языке.

2. Архитектура и проектирование
   2.1. Уважение к стилю: Соблюдать существующую архитектуру и паттерны проекта.
   2.2. Архитектурный диалог: Изменения в структуре проекта или глобальных интерфейсах обсуждаются до реализации.
   2.3. Принцип бойскаута: При обнаружении "запаха кода" в смежных участках — предложить рефакторинг отдельным шагом.
   2.4. Интерфейсы: Следовать правилу «Принимай интерфейсы, возвращай структуры» (Accept interfaces, return structs).

3. Стандарты написания кода на Go (Idiomatic Go)
   3.1. Стилистика:
   Следовать принципам Effective Go и Uber Go Style Guide.
   Использовать gofmt / goimports для форматирования.
   Предпочитать короткое объявление переменных := внутри функций.
   Группировать объявления var (...) и const (...).
   3.2. Функции и именование:
   Использовать camelCase для экспортируемых и неэкспортируемых идентификаторов.
   Использовать именованные возвращаемые значения только там, где это критически улучшает читаемость (в коротких функциях).
   3.3. Обработка ошибок:
   Никогда не игнорировать ошибки (\_).
   Использовать Error Wrapping: fmt.Errorf("context: %w", err) (Go 1.13+).
   Проверять ошибки через errors.Is и errors.As.
   3.4. Конкурентность:
   Применять goroutines и channels только когда это оправдано.
   Всегда контролировать жизненный цикл горутин через context.Context или сигнальные каналы.
   Использовать sync пакет (WaitGroup, Mutex, Pool) осознанно.
   3.5. Ресурсы: Использовать defer для гарантированного закрытия ресурсов (файлы, тела HTTP-ответов, мьютексы).

4. Безопасность и производительность
   4.1. Управление памятью:
   Избегать лишних аллокаций в горячих циклах.
   Использовать make с указанием емкости cap, если размер коллекции известен заранее.
   Понимать разницу между передачей по значению и по указателю.
   4.2. Контекст: Первым аргументом в функции, выполняющие I/O или долгие вычисления, всегда передавать ctx context.Context.
   4.3. Безопасность: Проверять код на состояние гонки (race conditions) и утечки памяти.
   4.4. Стандартная библиотека: Отдавать приоритет stdlib. Использование сторонних библиотек должно быть обосновано.

5. Тестирование и документация
   5.1. Тесты: Писать идиоматичные Table-driven tests (табличные тесты).
   5.2. Документация: Комментировать пакеты, структуры и экспортируемые функции.
   Акцент в комментариях делать на вопросе «Почему это сделано именно так?», а не просто «Что делает этот код».
   5.3. JSON: При работе с API всегда указывать json теги в структурах, использовать omitempty для необязательных полей.

6. Ограничения и запуск
   6.1. Запрет на исполнение: Никогда не использовать команду run go main.go.
   6.2. Проверка пользователем: Пользователь самостоятельно запускает сервер и проводит финальное тестирование.
   6.3. Атомарность: Каждое изменение должно быть логически завершенным и не нарушать компиляцию проекта.

7. Команда освобождения порта для echo
   7.1. bunx kill-port 8080 - команда для освобождения порта для echo

8. Команды, используемые в проекте go:
   8.1. go build ./... - сборка всего проекта для проверки на ошибки
   8.2. go mod tidy - проверка и обновление зависимостей модуля
   8.3. go vet ./... - проверка кода на потенциальные проблемы
   8.4. go install github.com/air-verse/air@latest - установка последней версии air - пакет для автоматической перезагрузки сервера при изменении кода
   8.5. templ generate - команда генерации шаблона в go - файл
   8.6. ./task.exe dev - команда запуска сервера в режиме разработки с автоматической перезагрузкой

9. Основной фреймворк для разработки веб-приложений
   9.1. https://echo.labstack.com/docs/quick-start - основная документация на фреймворк echo
   9.2. go get github.com/labstack/echo/v5 - команда для установки фреймворка echo в файле go.mod,
   9.2.1. шаблонизатор templ - go install github.com/a-h/templ/cmd/templ@latest
   9.3. первичный код сервера на echo в файле main.go
   "package main
